-- Sequence for revision IDs (if DB supports it, otherwise remove)
CREATE SEQUENCE IF NOT EXISTS REVINFO_SEQ START WITH 1 INCREMENT BY 50;

-- Revision info table (managed by Envers)
CREATE TABLE IF NOT EXISTS REVINFO (
    REV INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    REVTSTMP BIGINT
);

-- Audit table for PROFESSOR
CREATE TABLE IF NOT EXISTS PROFESSOR_AUD (
    ID BIGINT NOT NULL,
    REV INTEGER NOT NULL,
    REVTYPE SMALLINT,
    REVEND INTEGER,
    REVEND_TSTMP TIMESTAMP,
    NAME VARCHAR(255),
    DISCIPLINE_CODE VARCHAR(50),
    CODE VARCHAR(50),
    PRIMARY KEY (ID, REV),
    CONSTRAINT FK_PROFESSOR_AUD_REV FOREIGN KEY (REV) REFERENCES REVINFO (REV),
    CONSTRAINT FK_PROFESSOR_AUD_REVEND FOREIGN KEY (REVEND) REFERENCES REVINFO (REV)
);


-- Audit table for SCHOOL_CLASS
CREATE TABLE IF NOT EXISTS SCHOOL_CLASS_AUD (
    ID BIGINT NOT NULL,
    REV INTEGER NOT NULL,
    REVTYPE SMALLINT,
    REVEND INTEGER,
    REVEND_TSTMP TIMESTAMP,
    NAME VARCHAR(255),
    CLASS_CODE VARCHAR(50),
    CLASS_YEAR INT,
    PRIMARY KEY (ID, REV),
    CONSTRAINT FK_SCHOOL_CLASS_AUD_REV FOREIGN KEY (REV) REFERENCES REVINFO (REV),
    CONSTRAINT FK_SCHOOL_CLASS_AUD_REVEND FOREIGN KEY (REVEND) REFERENCES REVINFO (REV)
);

-- Audit table for CLASS_PROFESSOR (join table)
CREATE TABLE IF NOT EXISTS CLASS_PROFESSOR_AUD (
    CLASS_ID BIGINT NOT NULL,
    PROFESSOR_ID BIGINT NOT NULL,
    REV INTEGER NOT NULL,
    REVTYPE SMALLINT,
    REVEND INTEGER,
    REVEND_TSTMP TIMESTAMP,
    PRIMARY KEY (CLASS_ID, PROFESSOR_ID, REV),
    CONSTRAINT FK_CLASS_PROFESSOR_AUD_REV FOREIGN KEY (REV) REFERENCES REVINFO (REV),
    CONSTRAINT FK_CLASS_PROFESSOR_AUD_REVEND FOREIGN KEY (REVEND) REFERENCES REVINFO (REV)
);
